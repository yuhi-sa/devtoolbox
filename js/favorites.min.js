"use strict";
(function () {
var STORAGE_KEY = "devtoolbox-favorites";
function getFavorites() {
try {
var data = localStorage.getItem(STORAGE_KEY);
return data ? JSON.parse(data) : [];
} catch (e) {
return [];
}
}
function saveFavorites(favorites) {
try {
localStorage.setItem(STORAGE_KEY, JSON.stringify(favorites));
} catch (e) {
}
}
function getSlugFromCard(card) {
var href = card.getAttribute("href");
if (!href) return null;
var match = href.match(/tools\/([^/]+)\/?/);
return match ? match[1] : null;
}
function isFavorited(slug) {
return getFavorites().indexOf(slug) !== -1;
}
function toggleFavorite(slug) {
var favorites = getFavorites();
var idx = favorites.indexOf(slug);
if (idx !== -1) {
favorites.splice(idx, 1);
} else {
favorites.push(slug);
}
saveFavorites(favorites);
return idx === -1;
}
function createStarButton(slug) {
var btn = document.createElement("button");
btn.type = "button";
btn.className = "tool-card__favorite";
btn.setAttribute("aria-label", "お気に入り切替");
btn.textContent = isFavorited(slug) ? "\u2605" : "\u2606";
if (isFavorited(slug)) {
btn.classList.add("is-active");
}
btn.addEventListener("click", function (e) {
e.preventDefault();
e.stopPropagation();
var nowFavorited = toggleFavorite(slug);
btn.textContent = nowFavorited ? "\u2605" : "\u2606";
btn.classList.toggle("is-active", nowFavorited);
document.querySelectorAll('.tool-card__favorite[data-slug="' + slug + '"]').forEach(function (b) {
b.textContent = nowFavorited ? "\u2605" : "\u2606";
b.classList.toggle("is-active", nowFavorited);
});
renderFavoritesSection();
});
btn.setAttribute("data-slug", slug);
return btn;
}
function addStarButtons() {
var cards = document.querySelectorAll(".tool-card");
cards.forEach(function (card) {
var slug = getSlugFromCard(card);
if (!slug) return;
if (card.querySelector(".tool-card__favorite")) return;
card.setAttribute("data-slug", slug);
var btn = createStarButton(slug);
card.appendChild(btn);
});
}
function renderFavoritesSection() {
var existing = document.getElementById("favorites-section");
var favorites = getFavorites();
if (favorites.length === 0) {
if (existing) existing.remove();
return;
}
var allCards = document.querySelectorAll('.category .tool-card[data-slug]');
var favCards = [];
favorites.forEach(function (slug) {
allCards.forEach(function (card) {
if (card.getAttribute("data-slug") === slug) {
favCards.push(card);
}
});
});
if (favCards.length === 0) {
if (existing) existing.remove();
return;
}
var section = existing || document.createElement("section");
section.id = "favorites-section";
section.className = "favorites-section";
var html = '<h2 class="favorites-section__title">お気に入り</h2>';
html += '<div class="tool-grid">';
favCards.forEach(function (card) {
var clone = card.cloneNode(true);
var oldBtn = clone.querySelector(".tool-card__favorite");
if (oldBtn) oldBtn.remove();
html += clone.outerHTML;
});
html += '</div>';
section.innerHTML = html;
section.querySelectorAll(".tool-card").forEach(function (card) {
var slug = card.getAttribute("data-slug");
if (slug) {
var btn = createStarButton(slug);
card.appendChild(btn);
}
});
if (!existing) {
var firstCategory = document.querySelector(".category");
if (firstCategory) {
firstCategory.parentNode.insertBefore(section, firstCategory);
}
}
}
document.addEventListener("DOMContentLoaded", function () {
if (!document.querySelector(".category .tool-card")) return;
addStarButtons();
renderFavoritesSection();
});
})();