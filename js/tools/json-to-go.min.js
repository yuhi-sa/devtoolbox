"use strict";
(function(){
document.addEventListener("DOMContentLoaded",function(){
var a=document.getElementById("json-input"),b=document.getElementById("go-output"),c=document.getElementById("root-name"),d=document.getElementById("json-error"),e=document.getElementById("go-success"),f=document.getElementById("btn-convert"),g=document.getElementById("btn-clear"),h=document.getElementById("btn-copy");
function sE(m){d.textContent=m;d.hidden=false;e.hidden=true}
function sS(m){e.textContent=m;e.hidden=false;d.hidden=true}
function cM(){d.hidden=true;e.hidden=true}
function cap(s){if(!s)return s;return s.charAt(0).toUpperCase()+s.slice(1)}
function pc(s){return s.replace(/[^a-zA-Z0-9]/g," ").split(/\s+/).filter(function(x){return x.length>0}).map(function(x){return cap(x)}).join("")}
function gt(v){if(v===null)return"interface{}";if(typeof v==="boolean")return"bool";if(typeof v==="number")return Number.isInteger(v)?"int64":"float64";if(typeof v==="string")return"string";return null}
function convert(data,rn){
var structs=[],names={};
function un(n){var bn=pc(n)||"Struct";if(!names[bn]){names[bn]=1;return bn}names[bn]++;return bn+names[bn]}
function iat(arr,pn,ind){
if(arr.length===0)return"[]interface{}";
var ho=false,ha=false,pt=null,oi=[];
for(var i=0;i<arr.length;i++){var it=arr[i];if(it===null)pt="interface{}";else if(Array.isArray(it))ha=true;else if(typeof it==="object"){ho=true;oi.push(it)}else{var t=gt(it);if(pt===null)pt=t;else if(pt!==t)pt="interface{}"}}
if(ho){var mk={};oi.forEach(function(o){Object.keys(o).forEach(function(k){if(!mk[k])mk[k]=o[k]})});return"[]"+po(mk,pn,ind)}
if(ha){var fa=null;for(var j=0;j<arr.length;j++){if(Array.isArray(arr[j])){fa=arr[j];break}}return"[]"+iat(fa,pn+"Item",ind)}
if(pt)return"[]"+pt;return"[]interface{}"
}
function po(obj,n,ind){
var sn=un(n),lines=[],is=ind||"";
lines.push(is+"type "+sn+" struct {");
Object.keys(obj).forEach(function(k){var v=obj[k],fn=pc(k)||"Field",goT;if(v===null)goT="interface{}";else if(Array.isArray(v))goT=iat(v,k,is);else if(typeof v==="object")goT=po(v,k,is);else goT=gt(v);lines.push(is+"\t"+fn+" "+goT+' `json:"'+k+'"`')});
lines.push(is+"}");structs.push(lines.join("\n"));return sn}
if(Array.isArray(data)){var st=iat(data,rn,"");structs.push("type "+pc(rn)+" = "+st)}
else if(typeof data==="object"&&data!==null)po(data,rn,"");
else{var goT=gt(data)||"interface{}";structs.push("type "+pc(rn)+" = "+goT)}
return structs.reverse().join("\n\n")}
f.addEventListener("click",function(){cM();var inp=a.value.trim();if(!inp){sE("JSONを入力してください。");return}var data;try{data=JSON.parse(inp)}catch(ex){sE("JSON構文エラー: "+ex.message);b.value="";return}var rn=c.value.trim()||"AutoGenerated";try{b.value=convert(data,rn);sS("Go構造体を生成しました。")}catch(ex){sE("変換エラー: "+ex.message);b.value=""}});
g.addEventListener("click",function(){a.value="";b.value="";cM()});
h.addEventListener("click",function(){var t=b.value;if(!t)return;navigator.clipboard.writeText(t).then(function(){sS("コピーしました。")})});
});
})();
