"use strict";
(function () {
document.addEventListener("DOMContentLoaded", function () {
var lengthEl = document.getElementById("pw-length");
var lengthDisplayEl = document.getElementById("pw-length-display");
var uppercaseEl = document.getElementById("pw-uppercase");
var lowercaseEl = document.getElementById("pw-lowercase");
var digitsEl = document.getElementById("pw-digits");
var symbolsEl = document.getElementById("pw-symbols");
var countEl = document.getElementById("pw-count");
var strengthBar = document.getElementById("pw-strength-bar");
var strengthLabel = document.getElementById("pw-strength-label");
var outputEl = document.getElementById("pw-output");
var errorEl = document.getElementById("pw-error");
var successEl = document.getElementById("pw-success");
var btnGenerate = document.getElementById("btn-generate");
var btnClear = document.getElementById("btn-clear");
var btnCopy = document.getElementById("btn-copy");
var UPPERCASE = "ABCDEFGHIJKLMNOPQRSTUVWXYZ";
var LOWERCASE = "abcdefghijklmnopqrstuvwxyz";
var DIGITS = "0123456789";
var SYMBOLS = "!@#$%^&*()_+-=[]{}|;:',.<>?/~";
function showError(msg) {
errorEl.textContent = msg;
errorEl.hidden = false;
successEl.hidden = true;
}
function showSuccess(msg) {
successEl.textContent = msg;
successEl.hidden = false;
errorEl.hidden = true;
setTimeout(function () { successEl.hidden = true; }, 2000);
}
function clearMessages() {
errorEl.hidden = true;
successEl.hidden = true;
}
function getCharset() {
var charset = "";
if (uppercaseEl.checked) charset += UPPERCASE;
if (lowercaseEl.checked) charset += LOWERCASE;
if (digitsEl.checked) charset += DIGITS;
if (symbolsEl.checked) charset += SYMBOLS;
return charset;
}
function generatePassword(length, charset) {
var password = "";
var randomValues = new Uint32Array(length);
crypto.getRandomValues(randomValues);
for (var i = 0; i < length; i++) {
password += charset[randomValues[i] % charset.length];
}
return password;
}
function calculateStrength(length, charset) {
var poolSize = charset.length;
if (poolSize === 0) return { score: 0, label: "", color: "", width: 0 };
var entropy = length * Math.log2(poolSize);
var typesUsed = 0;
if (uppercaseEl.checked) typesUsed++;
if (lowercaseEl.checked) typesUsed++;
if (digitsEl.checked) typesUsed++;
if (symbolsEl.checked) typesUsed++;
var score;
if (entropy < 28) {
score = 0;
} else if (entropy < 36) {
score = 1;
} else if (entropy < 60) {
score = 2;
} else if (entropy < 80) {
score = 3;
} else {
score = 4;
}
if (typesUsed >= 3 && score < 4) score = Math.min(score + 1, 4);
var labels = ["非常に弱い", "弱い", "普通", "強い", "非常に強い"];
var colors = ["#e53e3e", "#ed8936", "#ecc94b", "#48bb78", "#38a169"];
var widths = [10, 25, 50, 75, 100];
return {
score: score,
label: labels[score],
color: colors[score],
width: widths[score]
};
}
function updateStrength() {
var length = parseInt(lengthEl.value, 10);
var charset = getCharset();
var strength = calculateStrength(length, charset);
if (charset.length === 0) {
strengthBar.style.width = "0%";
strengthBar.style.background = "";
strengthLabel.textContent = "";
return;
}
strengthBar.style.width = strength.width + "%";
strengthBar.style.background = strength.color;
strengthLabel.textContent = strength.label;
strengthLabel.style.color = strength.color;
}
lengthEl.addEventListener("input", function () {
lengthDisplayEl.textContent = lengthEl.value;
updateStrength();
});
uppercaseEl.addEventListener("change", updateStrength);
lowercaseEl.addEventListener("change", updateStrength);
digitsEl.addEventListener("change", updateStrength);
symbolsEl.addEventListener("change", updateStrength);
btnGenerate.addEventListener("click", function () {
clearMessages();
var charset = getCharset();
if (charset.length === 0) {
showError("文字種を1つ以上選択してください。");
return;
}
var length = parseInt(lengthEl.value, 10);
if (isNaN(length) || length < 8 || length > 128) {
showError("パスワード長は8〜128の範囲で指定してください。");
return;
}
var count = parseInt(countEl.value, 10);
if (isNaN(count) || count < 1) count = 1;
if (count > 20) count = 20;
countEl.value = count;
var results = [];
for (var i = 0; i < count; i++) {
results.push(generatePassword(length, charset));
}
outputEl.value = results.join("\n");
showSuccess(count + "件のパスワードを生成しました。");
});
btnClear.addEventListener("click", function () {
outputEl.value = "";
clearMessages();
});
btnCopy.addEventListener("click", function () {
var text = outputEl.value;
if (!text) return;
navigator.clipboard.writeText(text).then(function () {
showSuccess("コピーしました。");
});
});
updateStrength();
});
})();