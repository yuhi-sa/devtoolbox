"use strict";
(function () {
document.addEventListener("DOMContentLoaded", function () {
var ogTitle = document.getElementById("og-title");
var ogDesc = document.getElementById("og-description");
var ogImage = document.getElementById("og-image");
var ogUrl = document.getElementById("og-url");
var ogType = document.getElementById("og-type");
var ogSitename = document.getElementById("og-sitename");
var titleCount = document.getElementById("og-title-count");
var descCount = document.getElementById("og-desc-count");
var validationList = document.getElementById("validation-list");
var metaOutput = document.getElementById("meta-output");
var btnCopy = document.getElementById("btn-copy");
var fbImage = document.getElementById("fb-image");
var fbDomain = document.getElementById("fb-domain");
var fbTitle = document.getElementById("fb-title");
var fbDesc = document.getElementById("fb-desc");
var twImage = document.getElementById("tw-image");
var twDomain = document.getElementById("tw-domain");
var twTitle = document.getElementById("tw-title");
var twDesc = document.getElementById("tw-desc");
var slackDomain = document.getElementById("slack-domain");
var slackTitle = document.getElementById("slack-title");
var slackDesc = document.getElementById("slack-desc");
var slackImage = document.getElementById("slack-image");
var lineImage = document.getElementById("line-image");
var lineTitle = document.getElementById("line-title");
var lineDesc = document.getElementById("line-desc");
function extractDomain(url) {
if (!url) return "example.com";
try {
return new URL(url).hostname;
} catch (e) {
return url.replace(/^https?:\/\
}
}
function escapeHtml(s) {
return s.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;").replace(/"/g, "&quot;");
}
function setImagePreview(container, imageUrl, fallbackText) {
if (imageUrl) {
container.innerHTML = '<img src="' + escapeHtml(imageUrl) + '" alt="OG画像" onerror="this.parentElement.innerHTML=\'画像読み込みエラー\'">';
container.style.display = "";
} else {
container.innerHTML = fallbackText || "画像なし";
if (container === slackImage) container.style.display = "none";
}
}
function validate() {
var results = [];
var title = ogTitle.value.trim();
var desc = ogDesc.value.trim();
var image = ogImage.value.trim();
var url = ogUrl.value.trim();
if (title) {
if (title.length <= 60) {
results.push({ status: "pass", text: "og:title が設定されています（" + title.length + "文字）" });
} else {
results.push({ status: "warn", text: "og:title が60文字を超えています（" + title.length + "文字）。SNSで切り詰められる可能性があります。" });
}
} else {
results.push({ status: "fail", text: "og:title が未設定です（必須）" });
}
if (desc) {
if (desc.length <= 120) {
results.push({ status: "pass", text: "og:description が設定されています（" + desc.length + "文字）" });
} else {
results.push({ status: "warn", text: "og:description が120文字を超えています（" + desc.length + "文字）。切り詰められる可能性があります。" });
}
} else {
results.push({ status: "warn", text: "og:description が未設定です（推奨）" });
}
if (image) {
if (image.match(/^https:\/\
results.push({ status: "pass", text: "og:image がHTTPS URLで設定されています" });
} else if (image.match(/^http:\/\
results.push({ status: "warn", text: "og:image がHTTPです。HTTPSを推奨します。" });
} else {
results.push({ status: "fail", text: "og:image のURLが正しくありません。絶対URLを使用してください。" });
}
} else {
results.push({ status: "warn", text: "og:image が未設定です。SNSでのシェア時に画像が表示されません。" });
}
if (url) {
if (url.match(/^https?:\/\
results.push({ status: "pass", text: "og:url が設定されています" });
} else {
results.push({ status: "fail", text: "og:url のURLが正しくありません" });
}
} else {
results.push({ status: "warn", text: "og:url が未設定です（推奨）" });
}
validationList.innerHTML = "";
results.forEach(function (r) {
var div = document.createElement("div");
div.className = "validation-item validation-item--" + r.status;
var icon = r.status === "pass" ? "&#10003;" : r.status === "warn" ? "&#9888;" : "&#10007;";
div.innerHTML = '<span class="validation-item__icon">' + icon + '</span> ' + escapeHtml(r.text);
validationList.appendChild(div);
});
}
function updatePreviews() {
var title = ogTitle.value.trim() || "タイトル";
var desc = ogDesc.value.trim() || "説明文";
var image = ogImage.value.trim();
var url = ogUrl.value.trim();
var domain = extractDomain(url);
var sitename = ogSitename.value.trim() || domain;
setImagePreview(fbImage, image, "画像なし");
fbDomain.textContent = domain;
fbTitle.textContent = title;
fbDesc.textContent = desc;
setImagePreview(twImage, image, "画像なし");
twDomain.textContent = domain;
twTitle.textContent = title;
twDesc.textContent = desc;
slackDomain.textContent = sitename;
slackTitle.textContent = title;
slackDesc.textContent = desc;
setImagePreview(slackImage, image);
setImagePreview(lineImage, image, "画像なし");
lineTitle.textContent = title;
lineDesc.textContent = desc;
}
function updateCharCounts() {
var tLen = ogTitle.value.length;
var dLen = ogDesc.value.length;
titleCount.textContent = tLen + " / 60文字推奨";
titleCount.className = tLen > 60 ? "char-count char-count--warn" : "char-count";
descCount.textContent = dLen + " / 120文字推奨";
descCount.className = dLen > 120 ? "char-count char-count--warn" : "char-count";
}
function generateMeta() {
var tags = [];
var title = ogTitle.value.trim();
var desc = ogDesc.value.trim();
var image = ogImage.value.trim();
var url = ogUrl.value.trim();
var type = ogType.value;
var sitename = ogSitename.value.trim();
if (title) tags.push('<meta property="og:title" content="' + escapeHtml(title) + '">');
if (desc) tags.push('<meta property="og:description" content="' + escapeHtml(desc) + '">');
if (image) tags.push('<meta property="og:image" content="' + escapeHtml(image) + '">');
if (url) tags.push('<meta property="og:url" content="' + escapeHtml(url) + '">');
tags.push('<meta property="og:type" content="' + escapeHtml(type) + '">');
if (sitename) tags.push('<meta property="og:site_name" content="' + escapeHtml(sitename) + '">');
tags.push('<meta property="og:locale" content="ja_JP">');
tags.push("");
tags.push("<!-- Twitter Card -->");
tags.push('<meta name="twitter:card" content="' + (image ? "summary_large_image" : "summary") + '">');
if (title) tags.push('<meta name="twitter:title" content="' + escapeHtml(title) + '">');
if (desc) tags.push('<meta name="twitter:description" content="' + escapeHtml(desc) + '">');
if (image) tags.push('<meta name="twitter:image" content="' + escapeHtml(image) + '">');
metaOutput.value = tags.join("\n");
}
function update() {
updateCharCounts();
validate();
updatePreviews();
generateMeta();
}
[ogTitle, ogDesc, ogImage, ogUrl, ogSitename].forEach(function (el) {
el.addEventListener("input", update);
});
ogType.addEventListener("change", update);
btnCopy.addEventListener("click", function () {
var text = metaOutput.value;
if (!text) return;
window.DevToolBox.copyToClipboard(text).then(function () {
window.DevToolBox.showFeedback("コピーしました", "success");
});
});
update();
});
})();