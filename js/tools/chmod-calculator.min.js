"use strict";
(function () {
document.addEventListener("DOMContentLoaded", function () {
var numericEl = document.getElementById("chmod-numeric");
var symbolicEl = document.getElementById("chmod-symbolic");
var lsEl = document.getElementById("chmod-ls");
var successEl = document.getElementById("chmod-success");
var checkboxes = {
owner: {
r: document.getElementById("chmod-owner-r"),
w: document.getElementById("chmod-owner-w"),
x: document.getElementById("chmod-owner-x")
},
group: {
r: document.getElementById("chmod-group-r"),
w: document.getElementById("chmod-group-w"),
x: document.getElementById("chmod-group-x")
},
others: {
r: document.getElementById("chmod-others-r"),
w: document.getElementById("chmod-others-w"),
x: document.getElementById("chmod-others-x")
}
};
function showSuccess(msg) {
successEl.textContent = msg;
successEl.hidden = false;
setTimeout(function () { successEl.hidden = true; }, 2000);
}
function getOctalFromCheckboxes() {
var groups = ["owner", "group", "others"];
var result = "";
for (var i = 0; i < groups.length; i++) {
var g = groups[i];
var val = 0;
if (checkboxes[g].r.checked) val += 4;
if (checkboxes[g].w.checked) val += 2;
if (checkboxes[g].x.checked) val += 1;
result += val;
}
return result;
}
function getSymbolic() {
var groups = ["owner", "group", "others"];
var result = "";
for (var i = 0; i < groups.length; i++) {
var g = groups[i];
result += checkboxes[g].r.checked ? "r" : "-";
result += checkboxes[g].w.checked ? "w" : "-";
result += checkboxes[g].x.checked ? "x" : "-";
}
return result;
}
function setCheckboxesFromOctal(octal) {
var groups = ["owner", "group", "others"];
for (var i = 0; i < 3; i++) {
var digit = parseInt(octal[i], 10);
if (isNaN(digit) || digit < 0 || digit > 7) return false;
checkboxes[groups[i]].r.checked = (digit & 4) !== 0;
checkboxes[groups[i]].w.checked = (digit & 2) !== 0;
checkboxes[groups[i]].x.checked = (digit & 1) !== 0;
}
return true;
}
function updateDisplay() {
var octal = getOctalFromCheckboxes();
var symbolic = getSymbolic();
numericEl.value = octal;
symbolicEl.textContent = symbolic;
lsEl.textContent = "-" + symbolic;
}
var allCheckboxes = document.querySelectorAll("#chmod-table input[type='checkbox']");
allCheckboxes.forEach(function (cb) {
cb.addEventListener("change", updateDisplay);
});
numericEl.addEventListener("input", function () {
var val = numericEl.value.replace(/[^0-7]/g, "").slice(0, 3);
if (val.length === 3) {
setCheckboxesFromOctal(val);
var symbolic = getSymbolic();
symbolicEl.textContent = symbolic;
lsEl.textContent = "-" + symbolic;
}
});
var presetBtns = document.querySelectorAll(".chmod-preset");
presetBtns.forEach(function (btn) {
btn.addEventListener("click", function () {
var val = btn.getAttribute("data-value");
numericEl.value = val;
setCheckboxesFromOctal(val);
updateDisplay();
});
});
document.getElementById("btn-copy-numeric").addEventListener("click", function () {
navigator.clipboard.writeText(numericEl.value).then(function () {
showSuccess("数値をコピーしました。");
});
});
document.getElementById("btn-copy-symbolic").addEventListener("click", function () {
navigator.clipboard.writeText(symbolicEl.textContent).then(function () {
showSuccess("シンボリック表記をコピーしました。");
});
});
setCheckboxesFromOctal("755");
updateDisplay();
});
})();